 <!DOCTYPE HTML>
<html>
<head>
	<title>Using Backbone.js For SPWA</title>
	<!--- 
	<link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.7/themes/cupertino/jquery-ui.css" type="text/css" rel="stylesheet" />
	<link href="./css/index.css" type="text/css" rel="stylesheet" />
	 --->
	<!--- 
	These are for production:
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
	<script type="text/javascript" src="http://documentcloud.github.com/underscore/underscore.js"></script>
	<script type="text/javascript" src="http://documentcloud.github.com/backbone/backbone.js"></script>
	 --->
	 
	<!--- These are for when I'm on the airplane --->
	<script type="text/javascript" src="../html5love/js/jquery-1.4.4.min.js"></script>
	<script type="text/javascript" src="../jsexamples/js/underscore-min.js"></script>
	<script type="text/javascript" src="../jsexamples/js/backbone-min.js"></script>
	
		
	<script type='text/javascript'>
	$(function(){
			
		window.page = Backbone.Model.extend({});
		
		window.sitepages = Backbone.Collection.extend({
			model: page
		});
		
		window.pages = new sitepages;	
		
		window.pageView = Backbone.View.extend({
			 tagName			: "div"
			,className			: "page"
			,initialize: function(){
				_.bindAll(this, 'render', 'close');
      			this.model.bind('change', this.render);
			
				this.htmlCode = this.model.get('htmlCode');
				
      			this.model.view = this;
				this.render();
			}
			
			,render: function() {
				$(this.el).html($(this.model.get('htmlTemplate')).html());
				return this;
			}
		});
		
		var site = Backbone.Controller.extend({
			 el:		$('body')
			,routes: {
						"!:pageName": 'show'
			},
			initialize: function(contentPages){

				contentPages.each(function(i, contentPage){
					var contentPage = $(contentPage);
					var page = {
						 id: 			contentPage.attr('id').split('-')[0]						 
						,htmlTemplate:	'#' + contentPage.attr('id')
					}
					pages.add(page);
				})
			
				if (window.Backbone.history.getFragment() == ''){
					this.show('home')
				}
			},
			show: function(pageName) {
				var page = pages.get(pageName.toLowerCase());
				var view = new pageView({model: page});
				$(this.el).html(view.el);
			}
		});
		
		window.App = new site($('script[type=text/template]'));
		Backbone.history.start();
	});
	</script>
	
	<script type="text/template" id="home-template">
		Home Page<br />
		<a href="#!home">Home</a><br />
		<a href="#!contact">Contact</a><br />
		<a href="#!about">About</a><br />
	</script>
	
	<script type="text/template" id="about-template">
		About Page<br />
		<a href="#!home">Home</a><br />
		<a href="#!contact">Contact</a><br />
		<a href="#!about">About</a><br />
	</script>
	
	<script type="text/template" id="contact-template">
		Contact Page<br />
		<a href="#!home">Home</a><br />
		<a href="#!contact">Contact</a><br />
		<a href="#!about">About</a><br />
	</script>
	
</head>
<body></body>
</html>
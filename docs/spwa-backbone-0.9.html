<!DOCTYPE html>  <html> <head>   <title>spwa-backbone-0.9.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               spwa-backbone-0.9.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * spwa-backbone</span>
<span class="cm"> * version 0.9 (01/17/11)</span>
<span class="cm"> * http://github.com/ibjhb/spwa-backbone/</span>
<span class="cm"> * </span>
<span class="cm"> * @requires Backbone.js (http://documentcloud.github.com/backbone)</span>
<span class="cm"> * @requires Underscore (http://documentcloud.github.com/underscore)</span>
<span class="cm"> * @requires jQuery (http://jquery.com)</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2011 James Brown</span>
<span class="cm"> * Dual licensed under the MIT and GPL licenses:</span>
<span class="cm"> * http://www.opensource.org/licenses/mit-license.php</span>
<span class="cm"> * http://www.gnu.org/licenses/gpl.html</span>
<span class="cm">*/</span>

<span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
	</pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Define our page object:</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nb">window</span><span class="p">.</span><span class="nx">page</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">.</span><span class="nx">extend</span><span class="p">({});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Define our collection of pages:</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nb">window</span><span class="p">.</span><span class="nx">sitepages</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
		<span class="nx">model</span><span class="o">:</span> <span class="nx">page</span>
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Create a "pages" object which contains a collection of page models:</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nb">window</span><span class="p">.</span><span class="nx">pages</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sitepages</span><span class="p">;</span>	
	</pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Define our page view:</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nb">window</span><span class="p">.</span><span class="nx">pageView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Let's put each view into a div:</p>             </td>             <td class="code">               <div class="highlight"><pre>		 <span class="nx">tagName</span>			<span class="o">:</span> <span class="s2">&quot;div&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Setup a class for each view:</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="p">,</span><span class="nx">className</span>			<span class="o">:</span> <span class="s2">&quot;page&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>This runs when a new view is made:</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="p">,</span><span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
			</pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Keep render and close bound to "this":</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">_</span><span class="p">.</span><span class="nx">bindAll</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s2">&quot;render&quot;</span><span class="p">);</span>
			</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>When "change" is called, let's render the view:</p>             </td>             <td class="code">               <div class="highlight"><pre>  			<span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="s2">&quot;change&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span>
		</pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Setting the view into the model:</p>             </td>             <td class="code">               <div class="highlight"><pre>  			<span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">view</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Render out the view (page) to the screen:</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
		<span class="p">}</span>
		</pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>This function takes the html from the model, inserts into the view and renders it to the screen:</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="p">,</span><span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;htmlTemplate&quot;</span><span class="p">)).</span><span class="nx">html</span><span class="p">()).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">));</span>
			<span class="k">return</span> <span class="k">this</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Define our site:</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nb">window</span><span class="p">.</span><span class="nx">site</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Controller</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
		</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Set the app to the page body:</p>             </td>             <td class="code">               <div class="highlight"><pre>		 <span class="nx">el</span><span class="o">:</span>		<span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">)</span>
		 </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>This defines our routes and calls show when a route is encountered:</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="p">,</span><span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
					<span class="s2">&quot;!:pageName&quot;</span><span class="o">:</span> <span class="s2">&quot;show&quot;</span>
		<span class="p">},</span>
		</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Fire up when the site object is called.  We pass in a jQuery array of script objects:</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">contentPages</span><span class="p">){</span>
			</pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Loop over each object, define some attributes and push them into the "pages" collection:</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="nx">contentPages</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">i</span><span class="p">,</span> <span class="nx">contentPage</span><span class="p">){</span>
				<span class="kd">var</span> <span class="nx">contentPage</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">contentPage</span><span class="p">);</span>
				<span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="p">{</span>
					 <span class="nx">id</span><span class="o">:</span> 			<span class="nx">contentPage</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>						 
					<span class="p">,</span><span class="nx">htmlTemplate</span><span class="o">:</span>	<span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">contentPage</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
				<span class="p">}</span>
				<span class="nx">pages</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">page</span><span class="p">);</span>
			<span class="p">})</span>
			</pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>If there isn't a #!something set the site to "home":</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">getFragment</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">show</span><span class="p">(</span><span class="s2">&quot;home&quot;</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>This funciton does the actual page "switching".  It pulls the model out of the
collection of pages.  Then if the view doesn't exist, it creates it, if it does
it loads it, then shows it in the body:</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">pageName</span><span class="p">)</span> <span class="p">{</span>
			<span class="kd">var</span> <span class="nx">page</span> <span class="o">=</span> <span class="nx">pages</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">pageName</span><span class="p">);</span>
			<span class="kd">var</span> <span class="nx">view</span> <span class="o">=</span> <span class="p">(</span><span class="nx">page</span><span class="p">.</span><span class="nx">view</span><span class="p">)</span> <span class="o">?</span> <span class="nx">page</span><span class="p">.</span><span class="nx">view</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">pageView</span><span class="p">({</span><span class="nx">model</span><span class="o">:</span> <span class="nx">page</span><span class="p">});</span>
			<span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">view</span><span class="p">.</span><span class="nx">el</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">});</span>
	</pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Fire up our applicaiton and pass in an array of script/html objects</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nb">window</span><span class="p">.</span><span class="nx">App</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">site</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;script[type=text/template]&quot;</span><span class="p">));</span>
	</pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Start hashtag tracking via Backbone:</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 